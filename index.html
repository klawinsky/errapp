<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>eRegioJet — Logowanie</title>
  <link rel="stylesheet" href="style.css">
</head>
<body class="login-page">
  <main class="login-container">
    <div class="login-card">
      <h1>Logowanie / Rejestracja</h1>
      <label><span>Email</span><input id="login-email" type="email" /></label>
      <label><span>Hasło</span><input id="login-password" type="password" /></label>

      <div class="login-actions">
        <button id="login-btn">Zaloguj</button>
        <button id="register-btn">Zarejestruj</button>
        <button id="magic-btn">Wyślij magic link</button>
        <button id="login-demo-btn">Wejdź (DEMO)</button>
      </div>

      <p id="login-msg" style="color:#b00"></p>
    </div>
  </main>

  <!-- Supabase SDK i inicjalizacja -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script>
    const SUPABASE_URL = 'https://shqumvbmhcbeynrxozal.supabase.co';
    const SUPABASE_ANON_KEY = 'sb_publishable_QiF16mMls5_XMwf0DQYKLQ_ecmJTnyI';
    window.supabase = supabaseJs.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
  </script>

  <!-- Logika rejestracji/logowania -->
  <script>
    const msg = document.getElementById('login-msg');

    document.getElementById('login-demo-btn').addEventListener('click', () => {
      sessionStorage.setItem('eRJ_user', 'demo@eregiojet.local');
      window.location.href = 'app.html';
    });

    document.getElementById('register-btn').addEventListener('click', async () => {
      msg.textContent = '';
      const email = document.getElementById('login-email').value.trim();
      const password = document.getElementById('login-password').value;
      if (!email || !password) { msg.textContent = 'Podaj email i hasło'; return; }
      const res = await window.supabase.auth.signUp({ email, password });
      if (res.error) msg.textContent = 'Błąd rejestracji: ' + res.error.message;
      else msg.textContent = 'Zarejestrowano. Sprawdź e‑mail (jeśli włączone).';
    });

    document.getElementById('login-btn').addEventListener('click', async () => {
      msg.textContent = '';
      const email = document.getElementById('login-email').value.trim();
      const password = document.getElementById('login-password').value;
      if (!email || !password) { msg.textContent = 'Podaj email i hasło'; return; }
      const res = await window.supabase.auth.signInWithPassword({ email, password });
      if (res.error) { msg.textContent = 'Błąd logowania: ' + res.error.message; return; }
      const uid = res.data.user?.id || res.data?.user?.id;
      sessionStorage.setItem('eRJ_user', uid);
      window.location.href = 'app.html';
    });

    document.getElementById('magic-btn').addEventListener('click', async () => {
      msg.textContent = '';
      const email = document.getElementById('login-email').value.trim();
      if (!email) { msg.textContent = 'Podaj email'; return; }
      const res = await window.supabase.auth.signInWithOtp({ email });
      if (res.error) msg.textContent = 'Błąd: ' + res.error.message;
      else msg.textContent = 'Wysłano magic link na e‑mail.';
    });
  </script>
</body>
</html>
